<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>How is the OAB being distributed?</title>
	
	<meta name="author" content="Johan Veldhuis">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/dbtek">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/jveldh">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:johan@johanveldhuis.nl">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/8209ff9e4ba94ac3058e69fd75354b3f?s=35" class="img-circle" />
				Johan&#039;s Web Portal
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li><a href="/about.html"><i class="fa fa-eye"></i>About</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="//www.gravatar.com/avatar/8209ff9e4ba94ac3058e69fd75354b3f?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">Johan&#039;s Web Portal</a>
    </h3>
</header>



<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/dbtek">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/jveldh">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:johan@johanveldhuis.nl">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>How is the OAB being distributed? </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   October 
	   3rd,
	     
	   2011
	 </span>
	  <div class="article_body">
	  <p> As you may know Exchange by default has one Offline Address Book (OAB) and one Global Address List (GAL). The GAL contains all objects for which Exchange attributes are configured. For example groups, userobjects and contacts.</p>

<p>The OAB will be generated once a day by the <em>generation server</em>. Within an Exchange environment only one server is responsible for generating the OAB. This is always a server which contains the Mailbox Role.</p>

<p>To find out which server is responsible for generating the OAB you can use two methods:</p>

<p><strong>Exchange Management Console (EMC)</strong></p>

<ul>
  <li>Open <em>Organization Management</em></li>
  <li>Select the <em>Mailbox</em> object</li>
  <li>Select the tab <em>Offline Address Book</em></li>
</ul>

<p><em><a href="https://i1.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/emc_oab.jpg"><img title="Exchange Management Console: Offline Address Book tab" src="https://i2.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/emc_oab-300x17.jpg?resize=300%2C17" alt="" width="300" height="17" data-recalc-dims="1" /></a></em></p>

<p><strong>Exchange Management Shell (EMS)</strong></p>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Run the following cmdlet _get-offlineaddressbook</td>
          <td>select name,server_</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<p><em><a href="https://i2.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/ems_oab.jpg"><img title="Exchange Management Shell: oab" src="https://i2.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/ems_oab-300x38.jpg?resize=300%2C38" alt="" width="300" height="38" data-recalc-dims="1" /></a></em></p>

<p>On the generation server you will find the <em>ExchangeOAB</em> directory inside the Exchange directory. In this directory another folder is created. The name of this directory is the GUID from the OAB. Inside this directory several files are stored:</p>

<ul>
  <li>lzx, the addressbook files</li>
  <li>oab.xml, the index which points to the addressbook files. Without the oab.xml file the client will not be able to find and download the addressbook files.</li>
</ul>

<p>The OAB can be distributed via two methods:</p>

<ul>
  <li>Public Folders</li>
  <li>Web</li>
</ul>

<p>The Public Folders may be configured to have additional replica’s. This ensures that the OAB files are stored in multiple Public Folder databases. But how are the OAB files distributed to the Client Access Servers (CAS)?</p>

<p>To distribute the OAB to the configured CAS Servers the File Distribution service is used. This service runs on all CAS Servers and will check if a new OAB is available every 8 hours.</p>

<p>Sometimes this can has as effect that the users who are using Outlook in Online Mode and Outlook Web App can see new users earlier. This is sometimes very anoying.</p>

<p>To change this process you must change the <em>pollinterval</em> via EMS. This can be done by using the <em>set-oabvirtualdirectory</em> cmdlet:</p>

<p><em>Set-OabVirtualDirectory -identity “servername\OAB (Default Web Site)” -pollinterval 120</em></p>

<p>Using the example above we will reconfigure the CAS Servers to check every 2 hours for an update. But keep in mind that the GAL will only be generated once per day. If you wish to update an object perform the following steps:</p>

<ul>
  <li>update the object</li>
  <li>wait for AD replication</li>
  <li>run the following cmdlet_ Update-GlobalAddressList “Default Global Address List”_</li>
  <li>run the following cmdlet <em>Update-OfflineAddressBook “servername\OAB (Default Web Site)”</em></li>
  <li>run cmdlet_ Update-FileDistributionService_</li>
</ul>

<p>If you only want to distribute the OAB to the CAS Servers run the following cmdlet <em>Update-FileDistributionService.</em> This will ensure that the CAS Servers will check if an update is available for the OAB.</p>

<p>If there are still issues you will need to enable logging. The logging needs to be enabled on the CAS Servers which are responsible for distributing the OAB:</p>

<p>_Set-EventLog -Identity “MsExchangeFDS\General -Level Expert</p>

<p>_ <em>Set-EventLog -Identity “MsExchangeFDS\FileReplication -Level Expert</em></p>

<p>Force a replication using the File Replication service to verify if an update is available:</p>

<p><em>Update-FileDistributionService -identity servername</em></p>

<p>Once the cmdlet is executed check the <em>application</em> event log to verify the replication has occured.</p>

<p><a href="https://i1.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/update-frs.jpg"><img title="Update-FileDistributionService" src="https://i0.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/update-frs-300x110.jpg?resize=300%2C110" alt="" width="300" height="110" data-recalc-dims="1" /></a></p>

<p>In the screenshot above you can see the data synchronisation has started. In this case the Web distribution has just been enabled but the CAS server doesn’t have a copy.</p>

<p><a href="https://i1.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/update-frs-completed.jpg"><img title="update-FileReplicationService completed" src="https://i2.wp.com/johanveldhuis.nl/wp-content/uploads/2011/09/update-frs-completed-300x117.jpg?resize=300%2C117" alt="" width="300" height="117" data-recalc-dims="1" /></a></p>

<p>Once the OAB has been synchronized succesfully you will see the message above in the event log. When you browse to the directory X:\Program Files\Microsoft\Exchange Server\V14\ClientAccess\OAB zal you will find a directory which contains both the oab.xml and addressbook files.</p>

<p>Don’t forget to reset the logging level back to the original level once ready with troubleshooting:</p>

<p>_Set-EventLog -Identity “MsExchangeFDS\General -Level Lowest</p>

<p>_ <em>Set-EventLog -Identity “MsExchangeFDS\FileReplication -Level Lowest</em></p>

<p>Here ends the blog about how the OAB is distributed to the CAS Servers. If you would like to have more information about the cmdlet’s have a look at the sites below:</p>

<p>Technet: Update-FileDistributionService <a href="http://technet.microsoft.com/en-us/library/bb124697.aspx" target="_blank">open</a></p>

<p>Technet: Update-GlobalAddresslist: <a href="http://technet.microsoft.com/en-us/library/bb266966.aspx" target="_blank">open</a></p>

<p>Technet: Update-OfflineAddressBook: <a href="http://technet.microsoft.com/en-us/library/aa995979.aspx" target="_blank">open</a></p>

	  </div>
		
		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#Exchange 2010-ref">
					Exchange 2010 <span>(75)</span>
					
				</a></li>
			
		  
		</ul>
		  

		  

		<hr>

		<h4>Comments</h4>
		
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'johanveldhuis';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=How is the OAB being distributed?&via=jveldh"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="//www.gravatar.com/avatar/8209ff9e4ba94ac3058e69fd75354b3f" class="img-rounded author-image" />
        <h4 class="section-title author-name">Johan Veldhuis</h4>
        <p class="author-bio"></p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/new-mailboximportrequest-couldnt-connect-to-the-target-mailbox/" title="New-MailboxImportRequest: Couldn&#8217;t connect to the target mailbox">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/exchange-2010-sp1-rollup-6-vrij-gegeven/" title="Exchange 2010 SP1 Rollup 6 released">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>





		<footer>
			<hr/>
			<p>
				&copy; 2019 Johan Veldhuis with <a href="http://jekyllrb.com/">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'johanveldhuis', 'auto');
  ga('send', 'pageview');
</script>

